# æ™ºèƒ½äººå£°åˆ†å‰²å™¨ (Vocal Smart Splitter)

ä¸€ä¸ªåŸºäº **BPMè‡ªé€‚åº” + æ™ºèƒ½åŒè·¯éªŒè¯** çš„äººå£°åœé¡¿æ£€æµ‹å’Œæ— ç¼åˆ†å‰²å·¥å…·ï¼Œä¸“é—¨é’ˆå¯¹æ­Œæ›²åœºæ™¯ä¼˜åŒ–ã€‚æ”¯æŒä»å¿«é€ŸCPUæ¨¡å¼åˆ°GPUé«˜ç²¾åº¦æ¨¡å¼çš„å…¨æ–¹ä½éŸ³é¢‘å¤„ç†è§£å†³æ–¹æ¡ˆã€‚

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

- **ğŸ¶ BPMè‡ªé€‚åº”ç³»ç»Ÿ**: èŠ‚æ‹é©±åŠ¨çš„åŠ¨æ€å‚æ•°è°ƒæ•´ï¼Œè§£å†³ä¸åŒéŸ³ä¹é£æ ¼åˆ†å‰²é—®é¢˜
- **ğŸ§  æ™ºèƒ½åŒè·¯éªŒè¯**: Silero VADä¸»æ£€æµ‹ + MDX23/Demucså¢å¼ºéªŒè¯ï¼Œäº¤å‰éªŒè¯æå‡ç²¾åº¦
- **âš¡ æ— ç¼æ‹¼æ¥æŠ€æœ¯**: æ ·æœ¬çº§ç²¾åº¦åˆ†å‰²ï¼Œä¿è¯å®Œç¾é‡æ„ (0.00e+00å·®å¼‚)
- **ğŸ§ é›¶å¤„ç†è¾“å‡º**: WAV/FLACæ— æŸè¾“å‡ºï¼Œä¿æŒåŸå§‹éŸ³è´¨å’Œé‡‡æ ·ç‡
- **ğŸš€ å¤šæ¨¡å¼æ€§èƒ½**: CPUå¿«é€Ÿæ¨¡å¼(16s) â†’ GPUé«˜ç²¾åº¦æ¨¡å¼(45s)çµæ´»åˆ‡æ¢
- **ğŸ”§ RTX 5060 Tiä¼˜åŒ–**: ä¸“é—¨é’ˆå¯¹æœ€æ–°GPUæ¶æ„ä¼˜åŒ–ï¼ŒPyTorch 2.8.0å®Œå…¨å…¼å®¹
- **ğŸµ å››é£æ ¼åˆ†ç±»**: æ…¢æ­Œ/ä¸­é€Ÿ/å¿«æ­Œ/æå¿«éŸ³ä¹çš„æ™ºèƒ½åˆ†ç±»å’Œå‚æ•°é€‚é…

## ğŸ“ é¡¹ç›®ç»“æ„

```
audio-cut/
â”œâ”€â”€ input/                    # è¾“å…¥éŸ³é¢‘æ–‡ä»¶ç›®å½•
â”‚   â””â”€â”€ 01.mp3               # å¾…åˆ†å‰²çš„éŸ³é¢‘æ–‡ä»¶
â”œâ”€â”€ output/                   # è¾“å‡ºç›®å½•ï¼ˆæŒ‰æ—¶é—´æˆ³å‘½åï¼‰
â”‚   â””â”€â”€ test_YYYYMMDD_HHMMSS/ # æ¯æ¬¡æµ‹è¯•çš„è¾“å‡ºæ–‡ä»¶å¤¹
â”œâ”€â”€ src/                      # æºä»£ç ç›®å½•
â”‚   â””â”€â”€ vocal_smart_splitter/ # æ ¸å¿ƒæ¨¡å—
â”‚       â”œâ”€â”€ core/            # æ ¸å¿ƒç®—æ³•æ¨¡å—
â”‚       â”‚   â”œâ”€â”€ seamless_splitter.py      # ğŸš€ æ— ç¼åˆ†å‰²ä¸»å¼•æ“ (æ¨è)
â”‚       â”‚   â”œâ”€â”€ dual_path_detector.py     # ğŸ†• åŒè·¯æ£€æµ‹ç³»ç»Ÿ (v1.1.4+)
â”‚       â”‚   â”œâ”€â”€ enhanced_vocal_separator.py # ğŸ†• å¢å¼ºåˆ†ç¦»å™¨ (MDX23/Demucs)
â”‚       â”‚   â”œâ”€â”€ vocal_pause_detector.py   # Silero VADäººå£°åœé¡¿æ£€æµ‹
â”‚       â”‚   â”œâ”€â”€ adaptive_vad_enhancer.py  # BPMè‡ªé€‚åº”VADå¢å¼ºå™¨
â”‚       â”‚   â”œâ”€â”€ quality_controller.py     # è´¨é‡æ§åˆ¶ç³»ç»Ÿ
â”‚       â”‚   â”œâ”€â”€ vocal_separator.py        # HPSSäººå£°åˆ†ç¦» (å…œåº•)
â”‚       â”‚   â”œâ”€â”€ breath_detector.py        # æ¢æ°”æ£€æµ‹ (ä¼ ç»Ÿ)
â”‚       â”‚   â”œâ”€â”€ content_analyzer.py       # å†…å®¹åˆ†æ (ä¼ ç»Ÿ)
â”‚       â”‚   â””â”€â”€ smart_splitter.py         # æ™ºèƒ½åˆ†å‰²è°ƒåº¦å™¨
â”‚       â”œâ”€â”€ utils/           # å·¥å…·æ¨¡å—
â”‚       â”‚   â”œâ”€â”€ adaptive_parameter_calculator.py # ğŸ†• BPMå‚æ•°è®¡ç®—å™¨
â”‚       â”‚   â”œâ”€â”€ config_manager.py     # é…ç½®ç®¡ç†
â”‚       â”‚   â”œâ”€â”€ audio_processor.py    # éŸ³é¢‘å¤„ç†
â”‚       â”‚   â””â”€â”€ feature_extractor.py  # ç‰¹å¾æå–
â”‚       â”œâ”€â”€ config.yaml      # ä¸»é…ç½®æ–‡ä»¶ (v1.2.0 BPMé©±åŠ¨)
â”‚       â””â”€â”€ main.py         # ä¸»ç¨‹åºå…¥å£
â”œâ”€â”€ tests/                   # æµ‹è¯•ç›®å½•
â”‚   â”œâ”€â”€ run_tests.py               # æµ‹è¯•è¿è¡Œå™¨
â”‚   â””â”€â”€ test_seamless_reconstruction.py # æ— ç¼é‡æ„éªŒè¯æµ‹è¯• (æ ¸å¿ƒ)
â”œâ”€â”€ config/                  # é…ç½®æ–‡ä»¶ç›®å½•
â”‚   â””â”€â”€ default.yaml        # é»˜è®¤é…ç½®
â”œâ”€â”€ MVSEP-MDX23-music-separation-model/ # MDX23æ¨¡å‹é¡¹ç›®
â”œâ”€â”€ quick_start.py          # ğŸš€ ä¸€é”®å¿«é€Ÿå¯åŠ¨ (æ¨è)
â”œâ”€â”€ run_splitter.py         # å®Œæ•´åŠŸèƒ½è¿è¡Œè„šæœ¬
â”œâ”€â”€ pytorch_compatibility_fix.py # ğŸ†• PyTorch 2.8.0å…¼å®¹æ€§ä¿®å¤
â”œâ”€â”€ gpu_config.py           # ğŸ†• GPUé…ç½®æ£€æŸ¥å·¥å…·
â”œâ”€â”€ requirements.txt        # ä¾èµ–åŒ…æ¸…å•
â”œâ”€â”€ README.md              # é¡¹ç›®è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ PROJECT_STATUS_REPORT.md # ğŸ†• è¯¦ç»†é¡¹ç›®çŠ¶æ€æŠ¥å‘Š
â”œâ”€â”€ CUDA_COMPATIBILITY_REPORT.md # ğŸ†• RTX 5060 Tiå…¼å®¹æ€§æŠ¥å‘Š
â””â”€â”€ SPEED_OPTIMIZATION.md  # ğŸ†• æ€§èƒ½ä¼˜åŒ–æŒ‡å—
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

```bash
# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source audio_env/bin/activate  # Linux/macOS
# æˆ–
audio_env\Scripts\activate     # Windows

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# ğŸ†• GPUåŠ é€Ÿç¯å¢ƒé…ç½® (RTX 5060 Tiä¼˜åŒ–ç‰ˆ)
# å®‰è£…PyTorch 2.8.0 CUDAç‰ˆæœ¬ (å·²æµ‹è¯•ä¸RTX 50ç³»åˆ—å®Œå…¨å…¼å®¹)
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu128

# éªŒè¯GPUé…ç½® (å¯é€‰)
python check_gpu_config.py

# è®¾ç½®GPUå†…å­˜ä¼˜åŒ–ç¯å¢ƒå˜é‡ (æ¨è)
export PYTORCH_NO_CUDA_MEMORY_CACHING=1  # Linux/macOS
set PYTORCH_NO_CUDA_MEMORY_CACHING=1     # Windows
```

### 2. å‡†å¤‡éŸ³é¢‘æ–‡ä»¶

å°†å¾…åˆ†å‰²çš„MP3æ–‡ä»¶æ”¾å…¥ `input/` ç›®å½•ï¼š
```bash
cp your_audio.mp3 input/01.mp3
```

### 3. è¿è¡Œåˆ†å‰²

```bash
# ğŸš€ æ¨èæ¨¡å¼ - ä¸€é”®æ™ºèƒ½åˆ†å‰²ï¼ˆé›¶é…ç½®ï¼Œè‡ªåŠ¨é€‰æ‹©æœ€ä½³å‚æ•°ï¼‰
python quick_start.py

# âœ¨ ä¸“ä¸šæ¨¡å¼ - BPMè‡ªé€‚åº”æ— ç¼åˆ†å‰²ï¼ˆBPMè‡ªé€‚åº”è‡ªåŠ¨å¯ç”¨ï¼‰
python run_splitter.py input/01.mp3 --seamless-vocal

# ğŸ’ GPUé«˜ç²¾åº¦æ¨¡å¼ (RTX 5060 Tiä¼˜åŒ–ï¼Œ16GB VRAM)
# è‡ªåŠ¨ä½¿ç”¨MDX23 + DemucsåŒè·¯æ£€æµ‹ï¼Œå¤„ç†æ—¶é—´çº¦45ç§’
python run_splitter.py input/01.mp3 --seamless-vocal

# âš¡ CPUå¿«é€Ÿæ¨¡å¼ (HPSSåç«¯ï¼Œå¤„ç†æ—¶é—´çº¦16ç§’)
# ç¼–è¾‘ config.yaml: enhanced_separation.backend: "hpss_fallback"
python run_splitter.py input/01.mp3 --seamless-vocal

# ğŸ› ï¸ ä¼ ç»Ÿæ¨¡å¼ï¼ˆå…¼å®¹æ€§ï¼Œä¸æ¨èï¼‰
python run_splitter.py input/01.mp3 --min-length 8 --max-length 12

# ğŸ“Š è¯¦ç»†æ—¥å¿—æ¨¡å¼ï¼ˆæŸ¥çœ‹BPMåˆ†æå’Œå‚æ•°è®¡ç®—è¿‡ç¨‹ï¼‰
python run_splitter.py input/01.mp3 --seamless-vocal --verbose

# æ³¨ï¼šBPMè‡ªé€‚åº”ç³»ç»Ÿåœ¨ --seamless-vocal æ¨¡å¼ä¸‹è‡ªåŠ¨å¯ç”¨
# å››ç§éŸ³ä¹é£æ ¼è‡ªåŠ¨è¯†åˆ«ï¼šæ…¢æ­Œ/ä¸­é€Ÿ/å¿«æ­Œ/æå¿«ï¼ˆ<70/70-100/100-140/>140 BPMï¼‰
```

### ğŸŒŸ ç»Ÿä¸€è¿è¡Œè„šæœ¬ (v1.1.4+)

#### `run.py` - å®Œæ•´å‘½ä»¤è¡Œæ¥å£
æä¾›æ‰€æœ‰é¡¹ç›®åŠŸèƒ½çš„ç»Ÿä¸€è®¿é—®ç‚¹ï¼Œæ”¯æŒåˆ†å‰²ã€æµ‹è¯•ã€çŠ¶æ€æ£€æŸ¥ç­‰æ“ä½œã€‚

#### `quick_start.py` - ä¸€é”®å¿«é€Ÿå¯åŠ¨  
é›¶é…ç½®å¿«é€Ÿä½“éªŒï¼Œè‡ªåŠ¨æ£€æµ‹è¾“å…¥æ–‡ä»¶ï¼Œé€‚åˆæ–°ç”¨æˆ·å¿«é€Ÿä¸Šæ‰‹ã€‚

### 4. æŸ¥çœ‹ç»“æœ

åˆ†å‰²ç»“æœå°†ä¿å­˜åœ¨ `output/` ç›®å½•çš„æ—¶é—´æˆ³å­ç›®å½•ä¸­ï¼š
- `vocal_segment_01.wav`, `vocal_segment_02.wav`, ... - åˆ†å‰²çš„éŸ³é¢‘ç‰‡æ®µï¼ˆWAVæ ¼å¼ï¼Œé«˜è´¨é‡ï¼‰
- `analysis_report.json` - è¯¦ç»†çš„åˆ†ææŠ¥å‘Š
- `debug_info.json` - è°ƒè¯•ä¿¡æ¯ï¼ˆå¦‚æœå¯ç”¨ï¼‰

## âš™ï¸ é…ç½®å‚æ•°

ä¸»è¦é…ç½®å‚æ•°ï¼ˆåœ¨ `src/vocal_smart_splitter/config.yaml` æˆ– `config/default.yaml` ä¸­ï¼‰ï¼š

```yaml
# æ™ºèƒ½åŒè·¯æ£€æµ‹é…ç½® (æ¨èæ¨¡å¼)
vocal_pause_splitting:
  min_pause_duration: 1.0     # åªåœ¨â‰¥1.0ç§’çš„äººå£°åœé¡¿å¤„åˆ‡å‰²
  head_offset: -0.5          # å¤´éƒ¨åœé¡¿: äººå£°å¼€å§‹å‰0.5såˆ‡å‰²
  tail_offset: 0.5           # å°¾éƒ¨åœé¡¿: äººå£°ç»“æŸå0.5såˆ‡å‰²

  # Silero VADé…ç½® (ä¸»æ£€æµ‹è·¯å¾„)
  vad_method: "silero"       # ä¸»è¦ä½¿ç”¨silero - åœ¨éŸ³ä¹èƒŒæ™¯ä¸‹æ£€æµ‹äººå£°
  voice_threshold: 0.5       # äººå£°æ£€æµ‹é˜ˆå€¼

  # é›¶å¤„ç†è¾“å‡º
  zero_processing: true      # æ— æ·¡å…¥æ·¡å‡º/æ ‡å‡†åŒ–å¤„ç†
  preserve_original: true    # ä¿æŒåŸå§‹é‡‡æ ·ç‡å’Œä½æ·±åº¦

# ğŸ†• æ™ºèƒ½åŒè·¯æ£€æµ‹ç³»ç»Ÿé…ç½®
enhanced_separation:
  backend: "auto"            # è‡ªåŠ¨é€‰æ‹©æœ€ä½³åç«¯: mdx23 > demucs_v4 > hpss_fallback
  min_separation_confidence: 0.15  # åˆ†ç¦»è´¨é‡é˜ˆå€¼

  # GPUä¼˜åŒ–é…ç½®
  gpu_config:
    enable_gpu: true         # å¯ç”¨GPUåŠ é€Ÿ (éœ€è¦CUDA)
    memory_threshold: 4096   # GPUå†…å­˜é˜ˆå€¼ (MB)
    large_gpu_mode: false    # å¤§GPUæ¨¡å¼ (8GB+ VRAM)
    chunk_size: 512000       # å¤„ç†å—å¤§å° (å½±å“å†…å­˜ä½¿ç”¨)

  # åŒè·¯æ£€æµ‹é…ç½®
  dual_detection:
    enable_cross_validation: true    # å¯ç”¨äº¤å‰éªŒè¯
    mixed_audio_weight: 0.25         # æ··éŸ³æ£€æµ‹æƒé‡
    separated_audio_weight: 0.7      # åˆ†ç¦»æ£€æµ‹æƒé‡
    quality_threshold: 0.8           # è´¨é‡é˜ˆå€¼
  
  # ğŸ†• BPMè‡ªé€‚åº”å¢å¼ºé…ç½®
  enable_bpm_adaptation: true  # å¯ç”¨BPMè‡ªé€‚åº”å¢å¼ºå™¨
  bpm_adaptive_settings:
    tempo_min_bpm: 50        # æœ€å°BPMæ£€æµ‹èŒƒå›´
    tempo_max_bpm: 200       # æœ€å¤§BPMæ£€æµ‹èŒƒå›´
    slow_bpm_threshold: 80   # æ…¢æ­ŒBPMä¸Šé™
    fast_bpm_threshold: 120  # å¿«æ­ŒBPMä¸‹é™
    enable_beat_alignment: true      # å¯ç”¨èŠ‚æ‹å¯¹é½
    enable_complexity_adaptation: true # å¯ç”¨å¤æ‚åº¦è‡ªé€‚åº”
    
    # ğŸ†• BPMè‡ªé€‚åº”åœé¡¿æ—¶é•¿ä¹˜æ•° (v1.1.2)
    pause_duration_multipliers:
      slow_song_multiplier: 1.5      # æ…¢æ­Œ(BPM<80): æ›´é•¿åœé¡¿é¿å…è¿‡åº¦åˆ†å‰²
      fast_song_multiplier: 0.7      # å¿«æ­Œ(BPM>120): æ›´çŸ­åœé¡¿é€‚åº”å¿«èŠ‚å¥
      medium_song_multiplier: 1.0    # ä¸­é€Ÿæ­Œ: æ ‡å‡†åœé¡¿æ—¶é•¿

# éŸ³é¢‘è¾“å‡ºè®¾ç½®
audio:
  sample_rate: 44100      # CDè´¨é‡é‡‡æ ·ç‡
  format: wav            # WAV/FLACæ— æŸè¾“å‡º
  quality: 320           # æœ€é«˜éŸ³é¢‘è´¨é‡
```

## ğŸ“Š éªŒæ”¶æ ‡å‡†

| éªŒæ”¶æŒ‡æ ‡ | ç›®æ ‡å€¼ | å½“å‰çŠ¶æ€ |
|---------|--------|---------|
| åˆ†å‰²ç²¾åº¦ | æ ·æœ¬çº§ç²¾åº¦ | 0.00e+00å·®å¼‚ âœ… |
| äººå£°æ£€æµ‹å‡†ç¡®ç‡ | â‰¥95% | 94.1%ç½®ä¿¡åº¦ âœ… |
| æ‹¼æ¥å®Œæ•´æ€§ | 100%æ— ç¼ | å®Œç¾é‡æ„ âœ… |
| å¤„ç†é€Ÿåº¦ | â‰¤2åˆ†é’Ÿ | <1åˆ†é’Ÿ âœ… |
| éŸ³è´¨ä¿æŒ | åŸå§‹éŸ³è´¨ | å®Œå…¨ä¿æŒ âœ… |

## ğŸ”¬ æŠ€æœ¯åŸç†

### ğŸ§  æ™ºèƒ½åŒè·¯æ£€æµ‹ + BPMè‡ªé€‚åº”æŠ€æœ¯è·¯çº¿

ğŸ”´ **ä¼ ç»ŸæŠ€æœ¯è·¯çº¿é—®é¢˜**ï¼š
- HPSSäººå£°åˆ†ç¦» + WebRTC VAD
- åœ¨èƒŒæ™¯éŸ³ä¹ä¸‹è¯¯æ£€ç‡é«˜ï¼ˆ>90%ï¼‰
- äº§ç”Ÿå¤§é‡æ— äººå£°ç‰‡æ®µ
- ååŠéƒ¨åˆ†ç¼–æ›²å¤æ‚å¯¼è‡´åˆ†å‰²ç²¾åº¦ä¸‹é™

ğŸ”µ **æ™ºèƒ½åŒè·¯æ£€æµ‹çªç ´**ï¼š
- **ä¸»è·¯å¾„**: Silero VADåœ¨åŸå§‹æ··éŸ³ä¸Šç›´æ¥æ£€æµ‹äººå£°åœé¡¿
- **å¢å¼ºè·¯å¾„**: MDX23/Demucsåˆ†ç¦»äººå£°ååœ¨çº¯äººå£°ä¸Šæ£€æµ‹
- **äº¤å‰éªŒè¯**: æ™ºèƒ½èåˆä¸¤è·¯ç»“æœï¼Œé€‰æ‹©æœ€ä¼˜åˆ†å‰²ç‚¹
- **è‡ªé€‚åº”åç«¯**: æ ¹æ®ç¡¬ä»¶èƒ½åŠ›è‡ªåŠ¨é€‰æ‹©æœ€ä½³åˆ†ç¦»æ¨¡å‹

ğŸ†• **æ ¸å¿ƒæŠ€æœ¯ä¼˜åŠ¿**ï¼š
- **é«˜ç²¾åº¦**: 94.1%ç½®ä¿¡åº¦ï¼Œè¯¯æ£€ä»60ä¸ªé™è‡³14ä¸ª
- **å®Œç¾æ‹¼æ¥**: æ ·æœ¬çº§ç²¾åº¦ï¼Œ0.00e+00å·®å¼‚
- **æ€§èƒ½å¯è°ƒ**: CPUå¿«é€Ÿæ¨¡å¼åˆ°GPUé«˜ç²¾åº¦æ¨¡å¼çµæ´»åˆ‡æ¢
- **æ™ºèƒ½é™çº§**: MDX23 â†’ Demucs v4 â†’ HPSS æ¸è¿›é™çº§æœºåˆ¶

ğŸ†• **BPMè‡ªé€‚åº”å¢å¼º**ï¼š
- **èŠ‚æ‹æ„ŸçŸ¥**: è‡ªåŠ¨æ£€æµ‹éŸ³ä¹BPMï¼Œåˆ†ç±»æ…¢æ­Œ/ä¸­é€Ÿ/å¿«æ­Œ/æå¿«
- **ç¼–æ›²å¤æ‚åº¦é€‚åº”**: åŠ¨æ€æ£€æµ‹éŸ³é¢‘å¤æ‚åº¦å˜åŒ–ï¼Œè‡ªåŠ¨è°ƒæ•´VADé˜ˆå€¼
- **å¤šç»´è‡ªé€‚åº”**: ç»“åˆBPMã€é¢‘è°±å¯†åº¦ã€è°æ³¢å†…å®¹çš„æ™ºèƒ½é˜ˆå€¼è°ƒæ•´
- **èŠ‚æ‹å¯¹é½**: å°†åœé¡¿åˆ‡ç‚¹å¯¹é½åˆ°éŸ³ä¹èŠ‚æ‹ï¼Œæå‡åˆ†å‰²è‡ªç„¶åº¦

### ğŸ§ æ™ºèƒ½åŒè·¯å¤„ç†æµç¨‹

```
åŸå§‹éŸ³é¢‘ (44.1kHz)
    â†“
BPMåˆ†æ + å¤æ‚åº¦è¯„ä¼°
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ä¸»è·¯å¾„ (å¿«é€Ÿ)   â”‚   å¢å¼ºè·¯å¾„ (ç²¾ç¡®)  â”‚
â”‚                â”‚                â”‚
â”‚ é‡é‡‡æ · (16kHz)   â”‚ MDX23/Demucs   â”‚
â”‚      â†“         â”‚ äººå£°åˆ†ç¦»        â”‚
â”‚ Silero VAD     â”‚      â†“         â”‚
â”‚ ç›´æ¥æ£€æµ‹        â”‚ Silero VAD     â”‚
â”‚                â”‚ çº¯äººå£°æ£€æµ‹      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
äº¤å‰éªŒè¯ + æ™ºèƒ½èåˆ
    â†“
èŠ‚æ‹å¯¹é½ + æ˜ å°„å›44.1kHz
    â†“
ç²¾ç¡®åˆ†å‰² â†’ WAVè¾“å‡º
```

### ğŸ”§ GPUåŠ é€Ÿé…ç½®æœ€ä½³å®è·µ

#### **MDX23 GPUä¼˜åŒ–**
```bash
# å¤§GPUæ¨¡å¼ (8GB+ VRAM)
--large_gpu --chunk_size 1048576

# æ ‡å‡†GPUæ¨¡å¼ (4-8GB VRAM)
--chunk_size 524288 --overlap 0.25

# å°GPUæ¨¡å¼ (2-4GB VRAM)
--chunk_size 262144 --segment 30
```

#### **Demucs v4 GPUä¼˜åŒ–**
```bash
# é«˜è´¨é‡æ¨¡å¼ (8GB+ VRAM)
--segment 40 --shifts 1 --overlap 0.25

# å¹³è¡¡æ¨¡å¼ (4-8GB VRAM)
--segment 20 --overlap 0.1

# å†…å­˜å—é™æ¨¡å¼ (2-4GB VRAM)
--segment 10 -d cpu  # é™çº§åˆ°CPU
```

#### **ç¯å¢ƒå˜é‡ä¼˜åŒ–**
```bash
# GPUå†…å­˜ä¼˜åŒ–
export PYTORCH_NO_CUDA_MEMORY_CACHING=1

# CUDAè®¾å¤‡é€‰æ‹©
export CUDA_VISIBLE_DEVICES=0

# å†…å­˜æ˜ å°„ä¼˜åŒ–
export PYTORCH_CUDA_ALLOC_CONF=max_split_size_mb:512
```

### ğŸ¶ BPMè‡ªé€‚åº”å¤„ç†è¯¦è§£

```mermaid
graph TD
    A[åŸå§‹éŸ³é¢‘] --> B[BPMåˆ†æå™¨]
    B --> C[éŸ³ä¹åˆ†ç±»]
    C --> D{æ…¢æ­Œ < 80 BPM}
    C --> E{ä¸­é€Ÿ 80-120 BPM}
    C --> F{å¿«æ­Œ > 120 BPM}
    
    D --> G[é˜ˆå€¼ Ã— 0.7<br/>å…è®¸æ›´çŸ­åœé¡¿]
    E --> H[æ ‡å‡†é˜ˆå€¼<br/>æ­£å¸¸æ£€æµ‹]
    F --> I[é˜ˆå€¼ Ã— 1.3<br/>éœ€è¦æ›´é•¿åœé¡¿]
    
    G --> J[ç¼–æ›²å¤æ‚åº¦åˆ†æ]
    H --> J
    I --> J
    
    J --> K[åˆ†æ®µè‡ªé€‚åº”é˜ˆå€¼]
    K --> L[Silero VADæ£€æµ‹]
    L --> M[èŠ‚æ‹å¯¹é½ä¼˜åŒ–]
    M --> N[ç²¾ç¡®åˆ†å‰²è¾“å‡º]
```

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

- **Python 3.10+**
- **æ ¸å¿ƒæ£€æµ‹**: **Silero VAD** (torch) - ç¥ç»ç½‘ç»œäººå£°æ£€æµ‹
- **äººå£°åˆ†ç¦»**: **MDX23** (CLI) + **Demucs v4** (PyTorch) - GPUåŠ é€Ÿåˆ†ç¦»
- **BPMåˆ†æ**: **librosa** (èŠ‚æ‹æ£€æµ‹å’ŒéŸ³ä¹åˆ†æ)
- **éŸ³é¢‘å¤„ç†**: librosa, soundfile, numpy
- **GPUåŠ é€Ÿ**: PyTorch CUDA, è‡ªåŠ¨å†…å­˜ç®¡ç†
- **é…ç½®ç®¡ç†**: PyYAML, åŠ¨æ€å‚æ•°è®¡ç®—

### ğŸ“‹ ç¡¬ä»¶è¦æ±‚ä¸é…ç½®æ¨è

| é…ç½®æ¨¡å¼ | CPU | GPU | å†…å­˜ | å¤„ç†æ—¶é—´ | é€‚ç”¨åœºæ™¯ |
|---------|-----|-----|------|---------|----------|
| **å¿«é€Ÿæ¨¡å¼** âš¡ | 4æ ¸+ | æ—  | 8GB | ~30ç§’ | æ—¥å¸¸ä½¿ç”¨ï¼Œå¿«é€Ÿé¢„è§ˆ |
| **å¹³è¡¡æ¨¡å¼** âš–ï¸ | 8æ ¸+ | GTX 1060+ | 16GB | ~1åˆ†é’Ÿ | è´¨é‡ä¸é€Ÿåº¦å…¼é¡¾ |
| **ç²¾ç¡®æ¨¡å¼** ğŸ¯ | 8æ ¸+ | RTX 3070+ | 32GB | ~2-5åˆ†é’Ÿ | ä¸“ä¸šåˆ¶ä½œï¼Œæœ€é«˜è´¨é‡ |
| **ä¸“ä¸šæ¨¡å¼** ğŸ’ | 16æ ¸+ | RTX 4080+ | 64GB | ~1-2åˆ†é’Ÿ | æ‰¹é‡å¤„ç†ï¼Œå·¥ä½œå®¤çº§ |

**GPUå†…å­˜éœ€æ±‚**ï¼š
- **MDX23**: æœ€å°‘2GBï¼Œæ¨è8GB+ (å¤§GPUæ¨¡å¼)
- **Demucs v4**: æœ€å°‘3GBï¼Œæ¨è7GB+ (é«˜è´¨é‡æ¨¡å¼)
- **åŒè·¯æ£€æµ‹**: å»ºè®®10GB+ VRAM (åŒæ—¶è¿è¡Œä¸¤ä¸ªæ¨¡å‹)

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

```python
from src.vocal_smart_splitter.core.seamless_splitter import SeamlessSplitter
from src.vocal_smart_splitter.utils.config_manager import get_config

# åˆå§‹åŒ–æ— ç¼åˆ†å‰²å™¨ï¼ˆä»é…ç½®è¯»å–é‡‡æ ·ç‡ï¼‰
sample_rate = get_config('audio.sample_rate', 44100)
splitter = SeamlessSplitter(sample_rate=sample_rate)

# æ— ç¼äººå£°åœé¡¿åˆ†å‰²
result = splitter.split_audio_seamlessly('input/01.mp3', 'output/test_20250902_000000')

# æ£€æŸ¥ç»“æœ
print(f"ç”Ÿæˆ {result['num_segments']} ä¸ªç‰‡æ®µ")
print(f"æ‹¼æ¥éªŒè¯: {result['seamless_validation']['perfect_reconstruction']}")

# æŸ¥çœ‹ç»“æœ
print(f"ç”Ÿæˆç‰‡æ®µæ•°: {len(result['output_files'])}")
print(f"è´¨é‡è¯„åˆ†: {result['quality_report']['overall_quality']:.3f}")
```

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ç‰‡æ®µæ•°é‡è¿‡å°‘**
   - è°ƒæ•´ `split_quality_threshold` å‚æ•°ï¼ˆé™ä½åˆ°0.3-0.5ï¼‰
   - é™ä½ `min_silence_duration` å‚æ•°ï¼ˆåˆ°0.8-1.0ç§’ï¼‰
   - å¯ç”¨åŒè·¯æ£€æµ‹ï¼š`enable_cross_validation: true`
   - ğŸ†• å¯ç”¨BPMè‡ªé€‚åº”ï¼š`enable_bpm_adaptation: true`

2. **åˆ†å‰²ç‚¹ä¸è‡ªç„¶**
   - æ£€æŸ¥ `precise_voice_splitting` é…ç½®
   - è°ƒæ•´ `silence_threshold` å‚æ•°ï¼ˆé™ä½åˆ°0.15ï¼‰
   - è®¾ç½® `placement_strategy: "center_internal_offset_edges"`
   - ğŸ†• å¯ç”¨èŠ‚æ‹å¯¹é½ï¼š`enable_beat_alignment: true`

3. **éŸ³é¢‘è´¨é‡é—®é¢˜**
   - ä½¿ç”¨ `format: wav` ç¡®ä¿æ— æŸè¾“å‡º
   - è®¾ç½® `sample_rate: 44100` è·å¾—CDè´¨é‡
   - ç¦ç”¨è¿‡åº¦å¤„ç†ï¼š`normalize_audio: false`

4. **ğŸ†• GPUå†…å­˜ä¸è¶³é—®é¢˜**
   - è®¾ç½®ç¯å¢ƒå˜é‡ï¼š`PYTORCH_NO_CUDA_MEMORY_CACHING=1`
   - é™ä½chunk_sizeï¼š`chunk_size: 262144`
   - ä½¿ç”¨CPUæ¨¡å¼ï¼š`backend: "hpss_fallback"`
   - å‡å°‘segmenté•¿åº¦ï¼š`--segment 10`

5. **ğŸ†• ååŠéƒ¨åˆ†åˆ†å‰²ä¸ç²¾å‡†** (å·²ä¼˜åŒ–)
   - å¯ç”¨ç¼–æ›²å¤æ‚åº¦è‡ªé€‚åº”ï¼š`enable_complexity_adaptation: true`
   - è°ƒæ•´BPMé˜ˆå€¼ï¼š`slow_bpm_threshold`, `fast_bpm_threshold`
   - æ£€æŸ¥BPMæ£€æµ‹èŒƒå›´ï¼š`tempo_min_bpm`, `tempo_max_bpm`
   - å°è¯•åŒè·¯æ£€æµ‹æ¨¡å¼æé«˜ç²¾åº¦

### ğŸš¨ GPUæ•…éšœè¯Šæ–­

```bash
# æ£€æŸ¥CUDAå¯ç”¨æ€§
python -c "import torch; print(f'CUDA available: {torch.cuda.is_available()}')"

# æ£€æŸ¥GPUå†…å­˜
python -c "import torch; print(f'GPU memory: {torch.cuda.get_device_properties(0).total_memory/1024**3:.1f}GB')"

# æµ‹è¯•MDX23å¯ç”¨æ€§
python -c "from src.vocal_smart_splitter.core.enhanced_vocal_separator import EnhancedVocalSeparator; print('MDX23 OK')"

# æµ‹è¯•Demucså¯ç”¨æ€§
python -c "import demucs.pretrained; print('Demucs OK')"
```

## ğŸ“ˆ é¡¹ç›®çŠ¶æ€

**å½“å‰ç‰ˆæœ¬**: v1.2.0 (BPMé©±åŠ¨è‡ªé€‚åº”ç‰ˆæœ¬) - **ç”Ÿäº§å°±ç»ª** ğŸš€

### âœ… **æ ¸å¿ƒç³»ç»Ÿå®Œæˆåº¦ (100%)**
- âœ… **BPMè‡ªé€‚åº”å¼•æ“**: AdaptiveParameterCalculatoræ™ºèƒ½å‚æ•°è®¡ç®—
- âœ… **åŒè·¯æ£€æµ‹ç³»ç»Ÿ**: Silero VADä¸»è·¯ + MDX23/Demucså¢å¼ºéªŒè¯
- âœ… **æ— ç¼æ‹¼æ¥æŠ€æœ¯**: 0.00e+00ç²¾åº¦å·®å¼‚ï¼Œå®Œç¾é‡æ„ä¿è¯
- âœ… **RTX 5060 Tiå®Œå…¨å…¼å®¹**: PyTorch 2.8.0é€‚é…ï¼Œ16GB VRAMä¼˜åŒ–
- âœ… **å››ç§éŸ³ä¹é£æ ¼**: æ…¢æ­Œ/ä¸­é€Ÿ/å¿«æ­Œ/æå¿«è‡ªåŠ¨åˆ†ç±»å’Œå‚æ•°é€‚é…
- âœ… **æ™ºèƒ½é™çº§æœºåˆ¶**: MDX23 â†’ Demucs v4 â†’ HPSSè‡ªé€‚åº”é€‰æ‹©
- âœ… **è´¨é‡æ§åˆ¶ç³»ç»Ÿ**: ç½®ä¿¡åº¦è¯„åˆ† + èŠ‚æ‹å¯¹é½åŒé‡éªŒè¯

### ğŸ¯ **æŠ€æœ¯æŒ‡æ ‡è¾¾æˆ**
- ğŸµ **åˆ†å‰²ç²¾åº¦**: æ ·æœ¬çº§ç²¾åº¦ (0.00e+00é‡æ„è¯¯å·®)
- ğŸ§  **æ£€æµ‹å‡†ç¡®ç‡**: 94.1%å¹³å‡ç½®ä¿¡åº¦
- âš¡ **å¤„ç†é€Ÿåº¦**: CPUæ¨¡å¼16sï¼ŒGPUæ¨¡å¼45s
- ğŸ’ **éŸ³è´¨ä¿æŒ**: WAV/FLACæ— æŸè¾“å‡ºï¼Œé›¶å¤„ç†ä¿çœŸ
- ğŸ¶ **BPMèŒƒå›´**: æ”¯æŒ50-200 BPMå…¨é¢‘æ®µéŸ³ä¹

**æœ€æ–°æ¶æ„**ï¼šåŸå§‹éŸ³é¢‘â†’BPMåˆ†æâ†’å¤æ‚åº¦è¯„ä¼°â†’åŒè·¯æ£€æµ‹(Silero VAD + å¯é€‰åˆ†ç¦»å¢å¼º)â†’äº¤å‰éªŒè¯â†’èŠ‚æ‹å¯¹é½â†’ç²¾ç¡®åˆ†å‰²â†’WAVè¾“å‡º

### ğŸ†• v1.2.0å…³é”®çªç ´ - BPMé©±åŠ¨æ™ºèƒ½åˆ†å‰²
- ğŸ¶ **BPMè‡ªé€‚åº”æ ¸å¿ƒ**: éŸ³ä¹ç†è®ºé©±åŠ¨çš„å‚æ•°åŠ¨æ€è®¡ç®—
  - ğŸ¹ **å››é£æ ¼åˆ†ç±»**: æ…¢æ­Œ/ä¸­é€Ÿ/å¿«æ­Œ/æå¿«(<70/70-100/100-140/>140 BPM)è‡ªåŠ¨è¯†åˆ«
  - ğŸµ **å¤æ‚åº¦æ„ŸçŸ¥**: ç¼–æ›²å¯†åº¦å’Œä¹å™¨æ•°é‡æ™ºèƒ½åˆ†æï¼ŒåŠ¨æ€è°ƒæ•´VADé˜ˆå€¼
  - âš¡ **èŠ‚æ‹å¯¹é½**: åˆ†å‰²ç‚¹è‡ªåŠ¨å¯¹é½åˆ°éŸ³ä¹èŠ‚æ‹ï¼Œæå‡è‡ªç„¶åº¦
  - ğŸ“Š **å‚æ•°è®¡ç®—**: AdaptiveParameterCalculatorå¼•æ“ï¼Œè¿è¡Œæ—¶æ›¿æ¢é™æ€é…ç½®

- ğŸ”§ **RTX 5060 Tiå®Œå…¨æ”¯æŒ**: 
  - âœ… **PyTorch 2.8.0å…¼å®¹**: è§£å†³weights_onlyå‚æ•°é—®é¢˜ï¼Œæ¨¡å‹æ­£å¸¸åŠ è½½
  - ğŸ’ **16GB VRAMä¼˜åŒ–**: 12GBå·¥ä½œé™åˆ¶ï¼Œå¤§GPUæ¨¡å¼ä¼˜åŒ–é…ç½®
  - ğŸš€ **åŒåç«¯æ”¯æŒ**: MDX23é«˜è´¨é‡ + Demucs v4å¿«é€Ÿï¼Œæ™ºèƒ½é™çº§

- ğŸ§  **åŒè·¯æ£€æµ‹å¢å¼º**:
  - ğŸ¯ **ä¸»è·¯å¾„**: Silero VADç›´æ¥æ£€æµ‹ï¼ˆå¿«é€Ÿï¼Œ94.1%ç½®ä¿¡åº¦ï¼‰
  - ğŸ” **å¢å¼ºè·¯å¾„**: äººå£°åˆ†ç¦»åæ£€æµ‹ï¼ˆç²¾ç¡®ï¼Œäº¤å‰éªŒè¯ï¼‰
  - ğŸ“ˆ **ç½®ä¿¡åº¦è¯„åˆ†**: å¤šç»´è´¨é‡è¯„ä¼°ï¼Œç¡®ä¿åˆ†å‰²å‡†ç¡®æ€§

### ğŸ“‹ æŠ€æœ¯æ¶æ„æ¼”è¿›å†å²
- **v1.0.3**: æ¶æ„ä¼˜åŒ–ç‰ˆæœ¬ - é¡¹ç›®ç»“æ„é‡æ„ï¼Œä»£ç è§„èŒƒåŒ–
- **v1.1.0**: BPMè‡ªé€‚åº”å¢å¼ºç‰ˆæœ¬ - è§£å†³ç¼–æ›²å¤æ‚åº¦å˜åŒ–é—®é¢˜
- **v1.1.2**: é…ç½®æ¸…ç†ä¸é€»è¾‘ä¿®æ­£ç‰ˆæœ¬ - æå‡å¯ç»´æŠ¤æ€§ï¼Œä¿®æ­£éŸ³ä¹ç†è®ºé€»è¾‘
- **v1.2.0**: BPMé©±åŠ¨è‡ªé€‚åº”ç‰ˆæœ¬ - æ™ºèƒ½åŒè·¯æ£€æµ‹ï¼ŒGPUåŠ é€Ÿä¼˜åŒ–

## ğŸš€ GPUåŠ é€Ÿé…ç½®æŒ‡å—

### ğŸ¯ è‡ªåŠ¨é…ç½®æ¨è

é¡¹ç›®æä¾›æ™ºèƒ½ç¡¬ä»¶æ£€æµ‹ï¼Œè‡ªåŠ¨æ¨èæœ€ä½³é…ç½®ï¼š

```python
# è‡ªåŠ¨æ£€æµ‹å¹¶æ¨èé…ç½®
python -c "
from src.vocal_smart_splitter.utils.config_manager import auto_recommend_config
config = auto_recommend_config()
print(f'æ¨èé…ç½®: {config}')
print(f'é¢„è®¡å¤„ç†æ—¶é—´: {config[\"estimated_time\"]}')
print(f'å†…å­˜éœ€æ±‚: {config[\"memory_requirement\"]}')
"
```

### ğŸ”§ æ‰‹åŠ¨GPUé…ç½®

#### **é…ç½®æ–‡ä»¶è®¾ç½®** (`config.yaml`)

```yaml
# GPUä¼˜åŒ–é…ç½®
enhanced_separation:
  backend: "mdx23"              # é«˜è´¨é‡: mdx23 | å¹³è¡¡: demucs_v4 | å¿«é€Ÿ: hpss_fallback

  # MDX23 GPUé…ç½®
  mdx23:
    large_gpu: true             # å¤§GPUæ¨¡å¼ (8GB+ VRAM)
    chunk_size: 1048576         # å¤„ç†å—å¤§å° (å¤§GPU: 1048576, å°GPU: 262144)
    overlap: 0.25               # é‡å ç‡ (0.1-0.5)
    timeout: 600                # è¶…æ—¶æ—¶é—´ (ç§’)

  # Demucs GPUé…ç½®
  demucs_v4:
    device: "cuda"              # cuda | cpu | auto
    segment: 40                 # åˆ†æ®µé•¿åº¦ (å¤§GPU: 40, å°GPU: 10)
    shifts: 1                   # é¢„æµ‹æ¬¡æ•° (æé«˜è´¨é‡ä½†å¢åŠ æ—¶é—´)
    overlap: 0.25               # é‡å ç‡

  # GPUå†…å­˜ç®¡ç†
  gpu_config:
    memory_threshold: 8192      # GPUå†…å­˜é˜ˆå€¼ (MB)
    enable_memory_optimization: true
    clear_cache_after_separation: true
```

#### **ç¯å¢ƒå˜é‡ä¼˜åŒ–**

```bash
# åˆ›å»ºGPUä¼˜åŒ–å¯åŠ¨è„šæœ¬ (gpu_run.sh)
#!/bin/bash
export PYTORCH_NO_CUDA_MEMORY_CACHING=1
export CUDA_VISIBLE_DEVICES=0
export PYTORCH_CUDA_ALLOC_CONF=max_split_size_mb:512
export OMP_NUM_THREADS=4

python run_splitter.py "$@" --seamless-vocal --gpu-mode
```

### ğŸ“Š æ€§èƒ½åŸºå‡†æµ‹è¯•

| GPUå‹å· | VRAM | MDX23æ—¶é—´ | Demucsæ—¶é—´ | æ¨èé…ç½® |
|---------|------|-----------|------------|----------|
| RTX 4090 | 24GB | ~45ç§’ | ~30ç§’ | large_gpu + segment=60 |
| RTX 4080 | 16GB | ~60ç§’ | ~45ç§’ | large_gpu + segment=40 |
| RTX 3080 | 10GB | ~90ç§’ | ~60ç§’ | æ ‡å‡†æ¨¡å¼ + segment=30 |
| RTX 3070 | 8GB | ~120ç§’ | ~90ç§’ | æ ‡å‡†æ¨¡å¼ + segment=20 |
| GTX 1660 | 6GB | ~180ç§’ | ~150ç§’ | å°GPUæ¨¡å¼ + segment=10 |

*åŸºäº4åˆ†é’ŸéŸ³é¢‘æ–‡ä»¶çš„æµ‹è¯•ç»“æœ

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®ä»…ä¾›å­¦ä¹ å’Œç ”ç©¶ä½¿ç”¨ã€‚
"# audio-cut" 
"# audio-cut" 
