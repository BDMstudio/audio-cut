# todo.md · 项目开发进展与任务清单（更新于 2025-09-19）

## 0. 说明
- 状态：`[x] 完成` / `[/] 进行中` / `[ ] 未开始`
- 原则：不破坏兼容；重要变更配套测试；默认行为可回退

## 1. 已完成（Done）
- 终筛策略收敛（VPP 一次判定）：`_finalize_and_filter_cuts_v2(...)` 仅保留 NMS、守卫校正与最小间隔合并短段，移除二次插段强拆路径
- 守卫可配置化（QualityController）：
  - `quality_control.enforce_quiet_cut.{win_ms, guard_db, search_right_ms, floor_percentile}` 支持覆盖默认值
- README 增补“调参口诀（VPP + BPM）”，规范一次检测调参方法
- 清理冗余：关闭旧版“强制二次检测”路径；日志最小诊断（解释 venv/后端）

## 2. 进行中（Doing）
- [x] 文档对齐（README/development/PRD 小节精炼与截图补充）
- [/] 典型样本集回归（多风格：民谣/流行/电子/摇滚/说唱）

## 3. 待办（Backlog）
- [ ] 收集 `segment_classification_debug` 样本，评估 presence/energy 阈值在不同曲风的适配性
- [x] 增加以MDX23分离的纯人声音频分割片段输出，并以单独文件夹保存，与含有伴奏的音频区分开
- [ ] VPP 权重与相对阈值的数据集标定（自动调参脚本；验证不同风格分布）
- [ ] 一致性测试集（快歌和声、慢歌、电子、摇滚、说唱）与指标面板（片段数/时长分布/超长率）
- [ ] BPM 自适应因子再收敛（clamp/multipliers 的自动搜索与曲线拟合）
- [ ] 质量日志增强：守卫右推距离、边界偏移量、被最小间隔清理的候选统计
- [ ] README 增加“常见乐风调参示例”（仍由 BPM 驱动，不引入静音 profile）

## 4. 验收（针对本轮变更）
- 默认配置下：
  - 无 0s 片段
  - 一次检测产出的片段分布稳定，超长率显著下降
  - 拼接误差近似 0
- 开启守卫阈值覆盖后：
  - 结果随参数变化可解释，无明显退化（人工抽检 10+ 首样本）

## 5. Codex 当前任务（2025-09-20）
- [x] 阅读现有文档梳理项目技术路线
- [x] 调研核心模块与数据流
- [x] 分析 quick_start.py 调用 src/vocal_smart_splitter/core 的流程
- [x] 输出调研结论与后续建议
- [x] 排查智能命名输出后缀异常原因
- [x] P0-拼接杂音丨复现并核对 cut 边界（原混音 vs 纯人声），生成重建误差报告
- [x] P0-拼接杂音丨修正守卫/零交叉流程并补充拼接回归测试
- [x] P1-智能后缀丨整理误判样本并量化 presence/energy 分布
- [x] P1-智能后缀丨调整决策权重与阈值，补单元测试覆盖典型风格
- [x] P2-纯人声片段丨设计输出规范（命名、目录、配置开关）并更新文档
- [x] P2-纯人声片段丨实现分段导出并校验与伴奏版的起止一致性


